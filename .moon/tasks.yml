# Shared/global tasks that can be inherited by all projects
# https://moonrepo.dev/docs/config/tasks

$schema: 'https://moonrepo.dev/schemas/tasks.json'

# File groups for input/output management
fileGroups:
  sources:
    - 'src/**/*'
  configs:
    - '*.config.*'
    - 'tsconfig.json'
    - 'package.json'
  tests:
    - 'src/**/*.test.ts'
    - 'src/**/*.spec.ts'

# Implicit inputs for all tasks
implicitInputs:
  - 'package.json'

# Task definitions
tasks:
  # Development tasks
  dev:
    command: 'pnpm exec tsc --watch'
    local: true
    options:
      persistent: true

  # Build tasks
  build:
    command: 'pnpm exec tsc'
    deps:
      - '~:build'
    inputs:
      - '@group(sources)'
      - '@group(configs)'
    outputs:
      - 'dist'

  # Clean task
  clean:
    command: 'rm -rf dist'
    local: true

  # Type checking
  typecheck:
    command: 'pnpm exec tsc --noEmit'
    inputs:
      - '@group(sources)'
      - '@group(configs)'

  # Linting
  lint:
    command: 'pnpm exec biome check .'
    inputs:
      - '@group(sources)'
      - 'biome.json'

  # Formatting
  format:
    command: 'pnpm exec biome format --write .'
    inputs:
      - '@group(sources)'
      - 'biome.json'

  # Testing
  test:
    command: 'pnpm exec vitest run'
    inputs:
      - '@group(sources)'
      - '@group(tests)'
      - 'vitest.config.ts'
    options:
      runInCI: true

  test-watch:
    command: 'pnpm exec vitest'
    local: true
    options:
      persistent: true
